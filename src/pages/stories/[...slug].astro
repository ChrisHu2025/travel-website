---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const entries = await getCollection('stories');
  return entries.map(entry => ({
    params: { slug: entry.data.path },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<Layout title={`${entry.data.title} - Explore China`}>
  <article class="bg-white min-h-screen pb-20">
    <!-- Hero -->
    <div class="relative w-full h-[60vh] bg-gray-900">
      <img src={entry.data.image} alt={entry.data.title} class="absolute inset-0 w-full h-full object-cover opacity-80" />
      <div class="absolute inset-0 bg-black/20"></div>
    </div>

    <div class="container mx-auto px-4 max-w-3xl -mt-24 relative z-10">
      <div class="bg-white p-8 md:p-16 shadow-xl rounded-sm">

        <header class="text-center mb-14 border-b border-gray-100 pb-10">
          <div class="text-xs font-bold tracking-[0.2em] text-indigo-600 uppercase mb-4">Travel Story</div>
          <h1 class="text-3xl md:text-5xl font-serif font-bold text-gray-900 mb-6 leading-tight">{entry.data.title}</h1>

          <!-- Metadata -->
          <div class="flex flex-col sm:flex-row justify-center items-center gap-4 text-sm font-sans text-gray-500">
            <span>By <strong class="text-gray-900">{entry.data.author}</strong></span>
            <span class="hidden sm:inline">â€¢</span>
            <time datetime={entry.data.date.toISOString()}>
              {new Date(entry.data.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}
            </time>
          </div>

          <!-- Location Info (Minimal) -->
          <div class="mt-8 pt-8 border-t border-gray-50 flex justify-center gap-8 text-xs font-bold tracking-widest text-gray-400 uppercase">
            <a href={`/stories/${entry.data.city.toLowerCase()}`} class="hover:text-black transition-colors border-b border-transparent hover:border-black">{entry.data.city}</a>
            <span>{entry.data.region}</span>
          </div>
        </header>

        <div class="prose prose-lg prose-indigo mx-auto mb-10 font-serif text-xl leading-relaxed text-gray-600 italic">
          {entry.data.summary}
        </div>

        <div class="prose prose-lg prose-indigo mx-auto font-sans text-gray-800 prose-headings:font-serif">
          <Content />
        </div>
      </div>
    </div>
  </article>
</Layout>
