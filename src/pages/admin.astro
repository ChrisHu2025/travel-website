---
// src/pages/admin.astro
import '../styles/global.css';
export const prerender = true;

// ğŸ¯ åœ¨æ„å»ºé˜¶æ®µå‡†å¤‡å®Œæ•´çš„é…ç½®å¯¹è±¡
const cmsConfig = {
  backend: {
    name: 'github',
    repo: 'ChrisHu2025/travel-website', // è¯·ç¡®ä¿ä»“åº“åå‡†ç¡®
    branch: 'main',
    auth_scope: 'public_repo', // âš ï¸ é‡è¦ï¼šå…¬å¼€ä»“åº“ç”¨ â€˜public_repoâ€˜ï¼Œç§æœ‰ä»“åº“ç”¨ â€˜repoâ€˜
    auth_type: 'implicit',
    client_id: 'Ov23liJds0MQcgZsIeob', // ğŸ”¥ ç¡¬ç¼–ç åœ¨æ­¤å¤„
    base_url: 'https://explorechina.travel' // å¸®åŠ©æ„å»ºæ­£ç¡®å›è°ƒURL
  },
  site_url: 'https://explorechina.travel',
  display_url: 'https://explorechina.travel',
  media_folder: 'public/images/uploads',
  public_folder: '/images/uploads',
  load_config_file: false,
  // å¿…é¡»æä¾›è‡³å°‘ä¸€ä¸ªé›†åˆï¼ŒCMSç•Œé¢æ‰èƒ½æ­£å¸¸æ˜¾ç¤º
  collections: [
    {
      name: 'destinations',
      label: 'æ¨èç›®çš„åœ°',
      label_singular: 'ç›®çš„åœ°',
      folder: 'src/content/destinations',
      create: true,
      slug: '{{slug}}',
      fields: [
        { label: 'æ ‡é¢˜', name: 'title', widget: 'string' },
        { label: 'æè¿°', name: 'description', widget: 'text' },
        { label: 'æ­£æ–‡', name: 'body', widget: 'markdown' }
      ]
    }
  ]
};

// å°†é…ç½®å¯¹è±¡è½¬æ¢ä¸ºå¯åœ¨è„šæœ¬ä¸­å®‰å…¨ä½¿ç”¨çš„JSONå­—ç¬¦ä¸²
const cmsConfigString = JSON.stringify(cmsConfig).replace(/</g, '\\u003c');
---
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å†…å®¹ç®¡ç†ç³»ç»Ÿ - Explore China</title>
  <link rel="stylesheet" href="https://unpkg.com/decap-cms@^3.0.0/dist/cms.css">
  <style>
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    #nc-root { min-height: 100vh; }
    .cms-loading { text-align: center; padding-top: 40vh; color: #666; }
  </style>
</head>
<body>
  <div id="nc-root"></div>
  <div class="cms-loading" id="js-loading">æ­£åœ¨åŠ è½½å†…å®¹ç¼–è¾‘å™¨...</div>

  <!-- å…³é”®ï¼šä½¿ç”¨å…¨å±€è„šæœ¬åŠ è½½åº“ -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>

  <!-- å…³é”®ï¼šå†…è”è„šæœ¬ï¼Œå…¶ä¸­åŒ…å«ç”±Astroç›´æ¥å†™å…¥çš„é…ç½® -->
  <script>
    // âœ… ä¿®æ­£ç‚¹ï¼šä½¿ç”¨ JSON.parse å°†å­—ç¬¦ä¸²è§£æä¸ºé…ç½®å¯¹è±¡
    const CONFIG = JSON.parse(`cmsConfigString`);

    window.CMS_MANUAL_INIT = true;

    document.addEventListener('DOMContentLoaded', function() {
      function init() {
        if (!window.CMS) { setTimeout(init, 100); return; }

        console.log('æ­£åœ¨åˆå§‹åŒ–CMSï¼Œé…ç½®ï¼š', CONFIG.backend);

        // æ‰§è¡Œåˆå§‹åŒ–
        CMS.init({ config: CONFIG });

        // å¯é€‰ï¼šæˆåŠŸåŠ è½½åç§»é™¤æç¤º
        CMS.registerEventListener({
          name: 'init',
          handler: () => {
            const el = document.getElementById('js-loading');
            if (el) el.style.display = 'none';
            console.log('âœ… CMS UIå·²å°±ç»ªï¼Œåº”æ˜¾ç¤ºç™»å½•æŒ‰é’®ã€‚');
          }
        });
      }
      init();
    });
  </script>
</body>
</html>
